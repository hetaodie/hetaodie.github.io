---
layout: post
title: 编写高质量iOS的方法<一>
description: 此篇文章是《Effective objective》的读书笔记，写了一些自己的心得。
image: /assets/media/effective-object2.0.jpg
categories: [iOS]
tags: [iOS, 优化]

---
<img src="{{page.image}}" width="85%"/>
<br/>
<br/>
[Effective Objective-c 2.0：编写高质量iOS与OS X代码的52个有效的方法][1]，这本书非常好，看了很多遍，今天把自己看的，感觉很常用的知识记录下来，就当做是一个简单的读书笔记好了。

* 目录
 {:toc  }


##多用字面量语法，少用与之等价的方法

###要点
- 应该使用字面量语法来创建字符串、数值、数组、字典。与创建此类对象的常规方法相比，这么做更加简明扼要。
- 应该通过取下标操作来访问数组下标或字典中的键所对应的元素。
- 用字面语法创建数据和字典时，若值中有nil，则会抛出异常。因此务必确保值里不含nil。
- 使用字面量语法创建出来的字符串，数组，字典对象都是不可变得，若想要可变版本的对象，则需要复制一份。

###使用方式
####NSNumber

<p>
有时需要把整数、浮点数、布尔值封装入objective-c 对象中，这种情况下可以用NSNumber类，该类可处理多种类型的数值。若不用字面量，那么就需要按下面的方式进行创建：

{% highlight ruby %}

NSNumber *someNumber = [NSNumber numberWithInt:1];

{% endhighlight %}

然而使用字面量能令代码更为整洁：

{% highlight ruby %}

NSNumber *someNumber =@1;

{% endhighlight %}

能够以NSNumber实例表示的所有的数据类型都可以使用该语法。例如：

{% highlight ruby %}

NSNumber *intNumber =@1;
NSNumber *floatNumber =@2.5f;
NSNumber *doubleNumber =@3.1415926;
NSNumber *boolNumber =@YES;
NSNumber *charNumber =@'a';

{% endhighlight %}

字面量语法也使用于下述表达式

{% highlight ruby %}

int x = 5;
float y = 6.32f;
NSNumber *expresssionNumber = @{x * y};

{% endhighlight %}

</p>

####NSArray
数组是常用的数据结构，常规的创建数据的方法如下：

{% highlight ruby %}

  NSArray *animals = [NSArray arrayWithObjects:@"cat",@"dog",@"mouse",nil];

{% endhighlight %}

若使用字面量，则是：

{% highlight ruby %}

	NSArray *animals = @[@"cat",@"dog",@"mouse"];
	   
{% endhighlight %}

上面这种做法不仅简单，而且还有利于操作数组，数据的常见操作就是取某个下标所对应的对象。不用字面量的做法为：

{% highlight ruby %}

   NSString *dog = [animals objectAtIndex:1];

{% endhighlight %}

若使用字面量的做法为：


{% highlight ruby %}

   NSString *dog = [animals objectAtIndex:1];

{% endhighlight %}

大家想想：如果object1与object3都指向了有效的Objective-c对象，而object2是nil，那么会出现什么情况呢？按字面量语法创建的arrayB时会抛出异常。arrayA虽然能创建出来，大师其中却只含有object1一个对象。原因在于`arrayWithObjects:` 方法会依次处理各个参数，知道发现nil为止，由于object2是nil，所以该方法会提前结束。

* 这个微妙的差别表明，使用字面量语法更安全。抛出异常令应用程序终止结束，这比创建好数组之后才发现元素个数少了要好。*

####NSDictionary

字典的一般创建方法为：

{% highlight ruby %}

 NSDictionary *personData =[ NSDictionary  dictionaryWithObjectsAndKeys:@"Matt",@"firstName",@"Galloway",@"lastName",[NSNumber numberWithInt:28],@"age", nil];

{% endhighlight %}

而使用字面量的写法为：

{% highlight ruby %}

 NSDictionary *personData = @{@"firstName" : @"Matt",@"lastName" : @"Galloway", @"age" : @28};

{% endhighlight %}

通过取下标操作，可以访问数组中的某个小标或是字典中否个键所对应的元素。如果数组与字典是可变的，那么也可以通过下标修改其中的元素值。

## 多用类型常量，少用#define预处理指令

###要点
1. 不要用预处理指令定义常量。这样定义出来的常量不含任何类型的信息，编译器只是会在编译前据此执行查找与替代操作，即使有人重新定义了常量值，编译器也不会产生警告信息，这将导致应用程序中的常量值不一致。
2. 在显示文件中使用 static const 来定义“只在编译单元内可见的常量”。由于此类常量不在全局符号表中，所以无需为其名称加前缀。
3. 在头文件中使用extern来声明全局常量，并在相关实现文件中定义此值，这种常量要出现在全局符号中，所以此名称赢加以区隔，通常用与之相关的类名作为前缀。

##用枚举表示状态、选项、状态码
###要点
1. 应该用枚举来表示状态机的状态、传递给方法的选项以及状态码等值，给这些值起个易懂的名字。
2. 如果把传递给某个方法的选项表示为枚举类型，而多个选项又可同时使用，那么就将各选项定义为2的幂，以便通过按位或操作将其组合起来。
3. 用NS_ENUM 与NS_OPTIONS 宏来定义枚举类型，并指明起底层数据类型，这样做可以确保枚举是用开发者所选底层数据类型实现出来的，而不是采用编译器所选的类型。
4. 在处理枚举类型的switch语句中不要实现default分支，这样的话，加入新枚举之后，编译器就会提示开发者：switch语句并未处理所有的枚举。



<!--本文所用的超链接-->

[1]:http://www.amazon.cn/Effective-Objective-C-2-0-编写高质量iOS与OS-X代码的52个有效方法-加洛韦/dp/B00IDSGY06/ref=sr_1_4?ie=UTF8&qid=1454305577&sr=8-4&keywords=effective#nav-belt